- name: Ensure keychain is present
  package:
    name: keychain
    state: present
  become: true

- name: Ensure init block is present in `{{ keychain_login_file }}`
  blockinfile:
    path: "{{ keychain_login_file }}"
    insertafter: EOF
    state: present
    marker: "# {mark} :: ANSIBLE MANAGED BLOCK :: role=trallnag.keychain feead09a-b599-11eb-af8a-00155d2fcd36"
    block: |
      /usr/bin/keychain {{ keychain_args }}
      source ~/.keychain/$HOSTNAME-{{ keychain_used_shell }}
  notify:
    - "{{ role_name }} : Source keychain login file"

- name: Ensure `~/.keychain/` is present
  file:
    state: directory
    path: ~/.keychain/
